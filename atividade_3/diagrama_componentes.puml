@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

' Configurações para melhorar legibilidade
LAYOUT_TOP_DOWN()

' Aumentar espaçamento entre elementos
skinparam ranksep 100
skinparam nodesep 120

Person(user, "Concurseiro / Vestibulando", "Usuário que utiliza o sistema para gerenciar seus estudos.")

System_Boundary(s1, "Sistema de Gestão de Ciclos de Estudo") {

  Component(frontend, "Frontend", "React/Next.js", "Interface do usuário.")
  
  Component(api, "API Backend", "Quarkus REST", "Gerencia regras de negócio.")

  ' Services organizados verticalmente
  Component(cicloService, "CicloService", "Service", "Gerencia ciclos de estudo.")
  
  Component(disciplinaService, "DisciplinaService", "Service", "Gerencia disciplinas.")
  
  Component(revisaoService, "RevisaoService", "Service", "Agenda revisões automáticas.")
  
  Component(usuarioService, "UsuarioService", "Service", "Gerencia usuários.")
  
  Component(estatisticaService, "EstatisticaService", "Service", "Calcula estatísticas.")

  ComponentDb(db, "Banco de Dados", "PostgreSQL", "Armazena dados do sistema.")

  ' Relacionamentos internos
  Rel_Down(frontend, api, "Envia e recebe dados", "HTTPS/JSON")
  
  Rel_Down(api, cicloService, "Chama métodos de negócio")
  Rel_Down(api, disciplinaService, "Gerencia disciplinas")
  Rel_Down(api, revisaoService, "Agenda revisões")
  Rel_Down(api, estatisticaService, "Obtém estatísticas")
  Rel_Down(api, usuarioService, "Valida usuários")
  
  Rel(cicloService, db, "CRUD ciclos", "JPA")
  Rel(disciplinaService, db, "CRUD disciplinas", "JPA")
  Rel(revisaoService, db, "CRUD revisões", "JPA")
  Rel(estatisticaService, db, "Leitura métricas", "SQL")
}

' Sistemas externos
System_Ext(auth, "Serviço de Autenticação", "Autentica via OIDC/OAuth2")

System_Ext(apiConcursos, "API de Concursos", "Fornece dados de concursos")

System_Ext(grafana, "Dashboard Estatísticas", "Grafana/Tempo")

' Relacionamentos externos
Rel_Down(user, frontend, "Acessa via navegador", "HTTPS")

Rel_Down(usuarioService, auth, "Solicita autenticação", "OIDC/OAuth2")

Rel_Right(api, apiConcursos, "Consulta concursos", "REST API")

Rel_Right(api, grafana, "Exporta métricas", "Prometheus")

@enduml