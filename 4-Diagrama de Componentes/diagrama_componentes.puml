@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

title Diagrama de Componentes - Sistema de Gestão de Ciclos de Estudo

Person(user, "Concurseiro / Vestibulando", "Usuário que utiliza o sistema para gerenciar seus estudos.")

System_Ext(authSystem, "Serviço de Autenticação", "Autentica via OIDC/OAuth2")
System_Ext(emailSystem, "Provedor de E-mail/Push", "AWS SES / Firebase")
System_Ext(concursosApi, "API de Concursos", "Fornece dados de Concursos")

Container_Boundary(system, "Sistema de Gestão de Ciclos de Estudo") {
    
    Component(frontend, "Frontend", "React/Next.js", "Interface do usuário.")
    ComponentDb(db, "Banco de Dados", "PostgreSQL", "Armazena dados do sistema.")

    ' --- Vertical: Ciclo ---
    Component(cicloCtrl, "Ciclo Controller", "REST Controller", "Expõe endpoints de ciclos.")
    Component(cicloSvc, "Ciclo Service", "Service", "Gerencia ciclos de estudo.")
    Component(cicloRepo, "Ciclo Repository", "Repository", "Acesso a dados de ciclos.")

    ' --- Vertical: Disciplina ---
    Component(discCtrl, "Disciplina Controller", "REST Controller", "Expõe endpoints de disciplinas.")
    Component(discSvc, "Disciplina Service", "Service", "Gerencia disciplinas.")
    Component(discRepo, "Disciplina Repository", "Repository", "Acesso a dados de disciplinas.")

    ' --- Vertical: Revisao ---
    Component(revCtrl, "Revisao Controller", "REST Controller", "Expõe endpoints de revisões.")
    Component(revSvc, "Revisao Service", "Service", "Agenda revisões automáticas.")
    Component(revRepo, "Revisao Repository", "Repository", "Acesso a dados de revisões.")

    ' --- Vertical: Estatistica ---
    Component(estCtrl, "Estatistica Controller", "REST Controller", "Expõe endpoints de estatísticas.")
    Component(estSvc, "Estatistica Service", "Service", "Calcula estatísticas.")
    Component(estRepo, "Estatistica Repository", "Repository", "Leitura de métricas.")

    ' --- Vertical: Usuario (Exceção: Sistema Externo, sem Repo) ---
    Component(userCtrl, "Usuario Controller", "REST Controller", "Expõe endpoints de usuário.")
    Component(userSvc, "Usuario Service", "Service", "Gerencia autenticação e usuários.")

    ' --- Vertical: Notificacao (Exceção: Sistema Externo, sem Repo) ---
    Component(notifCtrl, "Notificacao Controller", "REST Controller", "Expõe endpoints de notificação.")
    Component(notifSvc, "Notificacao Service", "Service", "Gerencia envio de notificações.")

    Component(concursoCtrl, "Concurso Controller", "REST Controller", "Expõe endpoints dos concursos")
    Component(concursoSvc, "Concurso Service", "REST Controller", "Realiza busca por concursos")

}

' Relações Usuário e Frontend
Rel(user, frontend, "Acessa via navegador", "HTTPS")

' Frontend -> Controllers
Rel(frontend, cicloCtrl, "Gerencia ciclos", "HTTPS/JSON")
Rel(frontend, discCtrl, "Gerencia disciplinas", "HTTPS/JSON")
Rel(frontend, revCtrl, "Consulta revisões", "HTTPS/JSON")
Rel(frontend, estCtrl, "Obtém estatísticas", "HTTPS/JSON")
Rel(frontend, userCtrl, "Login/Cadastro", "HTTPS/JSON")
Rel(frontend, notifCtrl, "Configura notificações", "HTTPS/JSON")
Rel(frontend, concursoCtrl, "Consulta Concursos", "HTTPS/JSON")

' Fluxo Ciclo
Rel(cicloCtrl, cicloSvc, "Chama regras de negócio")
Rel(cicloSvc, cicloRepo, "Utiliza")
Rel(cicloRepo, db, "Lê/Escreve", "JPA")

' Fluxo Disciplina
Rel(discCtrl, discSvc, "Chama regras de negócio")
Rel(discSvc, discRepo, "Utiliza")
Rel(discRepo, db, "Lê/Escreve", "JPA")

' Fluxo Revisao
Rel(revCtrl, revSvc, "Chama regras de negócio")
Rel(revSvc, revRepo, "Utiliza")
Rel(revRepo, db, "Lê/Escreve", "JPA")

' Fluxo Estatistica
Rel(estCtrl, estSvc, "Chama regras de negócio")
Rel(estSvc, estRepo, "Utiliza")
Rel(estRepo, db, "Lê dados", "SQL")

' Fluxo Usuario (Conexão externa, sem repo)
Rel(userCtrl, userSvc, "Processa requisição")
Rel(userSvc, authSystem, "Solicita autenticação", "OIDC/OAuth2")

' Fluxo Notificacao (Conexão externa, sem repo)
Rel(notifCtrl, notifSvc, "Processa envio")
Rel(notifSvc, emailSystem, "Envia e-mail/push", "HTTP")

Rel(concursoCtrl, concursoSvc, "Processa Requisição" )
Rel(concursoSvc,concursosApi, "Request na API externa", "HTTP" )

@enduml