@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

' Layout
LAYOUT_WITH_LEGEND()

title Diagrama de Container - Sistema de Gestão de Ciclos de Estudo (Com Observabilidade)

Person(student, "Concurseiro / Vestibulando", "Gerencia seus ciclos de estudo e revisões.")
Person_Ext(admin, "DevOps / Admin", "Monitora a saúde da infraestrutura.")

System_Ext(auth_system, "Serviço de Autenticação", "OIDC/OAuth2 (Keycloak/Auth0)")
System_Ext(public_exams_api, "API de Concursos Públicos", "Fornece dados de editais e vagas.")
System_Ext(email_system, "Provedor de E-mail/Push", "AWS SES / Firebase")

System_Ext(prometheus, "Prometheus", "Time Series Database\n(Coletor)")
System_Ext(grafana, "Grafana", "Observability Platform\n(Visualizador)")

System_Boundary(study_system, "Ecossistema de Gestão de Estudos") {
    
    Container(spa, "Frontend Web", "React / Next.js", "Interface interativa para o usuário.")
    Container(backend, "API Backend", "Java / Quarkus", "Gerencia regras de negócio. Expõe endpoint /q/metrics.")
    ContainerDb(database, "Banco de Dados", "PostgreSQL", "Armazena dados transacionais (ciclos, tarefas).")
        
}

Rel(student, spa, "Usa", "HTTPS")
Rel(spa, backend, "Solicita dados", "JSON/HTTPS")

Rel(backend, auth_system, "Valida Tokens", "HTTPS")
Rel(backend, database, "Leitura/Escrita", "JDBC/JPA")
Rel(backend, public_exams_api, "Sincroniza Editais", "HTTPS")
Rel(backend, email_system, "Dispara", "HTTPS")

Rel(prometheus, backend, "Scrape (Coleta métricas)", "HTTP /q/metrics")

Rel(grafana, prometheus, "Consulta dados (PromQL)", "HTTP")

Rel(admin, grafana, "Visualiza Dashboards", "HTTPS")

@enduml